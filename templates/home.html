<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, 
    shrink-to-fit=no"
    />
    <title>Search Engine</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="../static/gfstyle.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      $(document).ready(() => {
        function getPrediction(data) {
          $.ajax({
            url: "/predict",
            type: "POST",
            data: data,
            success: function (response) {
              const { message = "", data = [] } = JSON.parse(response);
              $("#datalistOptions").children().remove();
              if (data.length == 1) return;
              for (var i = 0; i < data.length && i < 10; i++) {
                const { title } = data[i];
                $("#datalistOptions").append(
                  `<option value="${title}"></option>`
                );
              }
            },
            error: function (err) {
              console.log(err);
            },
          });
        }

        function search(data) {
          $.ajax({
            url: "/search",
            type: "POST",
            data: data,
            success: function (response) {
              const { message = "", data = [] } = JSON.parse(response);
              $("#result").children().remove();
              data.forEach((record) => {
                const { title, description, url } = record;
                $("#result").append(` <a href="${url}">
          <h3>${title}</h3>
        </a>
        <div class="caption left">
          <p>${description}</p>
        </div>`);
              });
              $("#datalistOptions").children().remove();
            },
            error: function (err) {
              console.log(err);
            },
          });
        }
        $("#search").on("input", function () {
          const val = $("#search").val();
          if (!val) return;
          getPrediction({ search: $("#search").val() });
        });
        $("#searchForm").submit((e) => {
          e.preventDefault();
          console.log(e);
          const val = $("#search").val();
          if (!val) return;
          search({ search: $("#search").val() });
        });
      });
    </script>
  </head>

  <body>
    <header class="container" style="margin-top: 5%">
      <div class="center">
        <div class="text-center"><h1 class="text-success">Cyberminer</h1></div>
        <div class="text-center">
          <form class="form-inline justify-content-center" id="searchForm">
            <input
              class="form-control"
              list="datalistOptions"
              id="search"
              name="search"
              type="search"
              placeholder="Search.."
              aria-label="Search"
              value="{{keyword}}"
            />
            <datalist id="datalistOptions"> </datalist>

            <button
              class="btn my-2 my-sm-0 text-primary"
              type="submit"
              id="searchBtn"
            >
              Search
            </button>
          </form>
        </div>
        <hr />
      </div>
    </header>

    <div class="container-fluid">
      <div></div>
      <div id="result">
        {% for result in results %}
        <a href="{{ result[3] }}">
          <h3>{{result[1]}}</h3>
        </a>
        <div class="caption left">
          <p>{{ result[2] }}</p>
        </div>

        {% endfor %}
      </div>
    </div>

    <footer>
      <div class="footer-2" style="margin-bottom: 5%">
        <p class="copyright">Copyright @ 2021 Creative Commons StarUps</p>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-center">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item"><a href="#">About</a></li>
            <li class="breadcrumb-item"><a href="#">Contact</a></li>
            <li class="breadcrumb-item"><a href="#">Browse</a></li>
          </ol>
        </nav>
      </div>
    </footer>
  </body>
</html>
